# Используем официальный образ Golang
FROM golang:1.21 AS builder

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Копируем go.mod и go.sum, чтобы установить зависимости (это кешируется, если файлы не менялись)
COPY ../go.mod ../go.sum ./

# Загружаем зависимости
RUN go mod tidy

# Копируем все файлы в рабочую директорию контейнера
COPY ../ ./

# Собираем приложение
RUN go build -o bot ./cmd/bot/main.go

# Второй этап: создание финального образа
FROM debian:bullseye-slim

# Создаем рабочую директорию в контейнере
WORKDIR /app

# Копируем скомпилированный бинарник из первого этапа
COPY --from=builder /app/bot .

# Указываем команду для запуска бота
CMD ["./bot"]

# Пробрасываем порт, если это необходимо (например, для webhook)
EXPOSE 8080
